language: c
dist: bionic

matrix:
  include:
    - os: linux
      env:
        - HOST="x86_64"
    - os: linux
      env:
        - HOST="i686"

script:
  ci/build.sh ${HOST}

install:
  ci/install.sh

addons:
  apt:
    packages:
    - libgmp3-dev
    - libmpc-dev
    - libmpfr-dev
    - libisl-dev
    - texinfo
    - bison
    - flex

before_deploy:
  - git config --local user.name "Antonino Natale"
  - git config --local user.email "antonio.natale97@hotmail.com"
  - export TRAVIS_TAG=v0.6.$(date +'%Y%m%d')
  - git tag $TRAVIS_TAG

deploy:
  provider: releases
  api_key:
    secure: PxEaPjNSkNhgOYUmUmE9ltw9URiPros+QTO14l1FbnC3VCRb1doJhC9YCuHfBWF8cSVOSQeXVApz9+HkZNbDqdZEVoUCbyf3Zc/yX+WZZxal02y/5znsiP+Uk5k7rNYymM7K8/VO6cOneyICkfTv1v0mNktsNtwYU/l1vmpNURwVpYYPLG/A1GeFSXBNG6OaJQUHRZLWedzLnibtdrPjsD+eefbdXxepusB572TgE3ArzN4qastGwRQr02D0z4VktDJ6/LdOiMLsmHjEmYvGv4lmMXpzpEWDRgdjdgV6yankyHzyiPMA+nVXwIXoKWwcAEG+G7+WD7bFLrmkj/IpHwVoKoGNHC2z4EOXg9LUwkv+CwX67pXtv++hirKNkoz0E3b9Pz0rjnZeM/829EC0faV8B5TmOBNo6Z8/8PVnjwUB15Nsp5feHPGxXypIpXd0955KL913gutPkhdqahWvkINlbosujephRFZa3/9HCG9KezTFi34I0euFJax3C6vOFL7gsvN0PheLn0kzZMtr/xwf0KcrTJvrnzvvTWFea4XAPG9mcmTJvauO+N51Tkt2tpyf63UvI6i1OLaoGMo5sbbs5DlglDU5SvfHD31Eo/66WdtggSsh8cl/wihDTQixrV4S2o5X0kMBP3WUn1XHizxiFjKS+5Fkgkl7lE4mhyM=
    
  file:
    - ${HOST}-aplus-toolchain-nocxx.tar.xz
    - ${HOST}-aplus-toolchain.tar.xz

  skip_cleanup: true
  overwrite: true
  draft: false

  on:
    repo: kwrx/aplus-toolchain
    tags: false
